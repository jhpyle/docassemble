---
metadata:
  description: |
    Citizenship attestation
  authors:
    - name:  
      organization: None
  revision_date: 2015-08-29
---
include:
  - basic-questions.yml
---
imports:
  - datetime
---
objects:
  - form_recipient: Individual
  - other_form_recipient: Individual  
---
code: |
  form_recipient.name.first      = 'Jonathan'
  form_recipient.name.last       = 'Pyle'
  form_recipient.email           = 'jpyle@philalegal.org'
  form_recipient.organization    = 'Philadelphia Legal Assistance'
  form_recipient.address.address = '718 Arch Street'
  form_recipient.address.unit    = 'Suite 300N'
  form_recipient.address.city    = 'Philadelphia'
  form_recipient.address.state   = 'PA'
  form_recipient.address.zip     = '19106'
  form_recipient.phone           = '215.981.3800'
  form_recipient.fax             = '215.981.3870'
  form_recipient.org_email       = 'faxes@philalegal.org'
---
code: |
  other_form_recipient.name.first = 'Legal'
  other_form_recipient.name.last = 'Server'
---
code: |
  other_form_recipient.email = url_args.get('caseid', None)
  if other_form_recipient.email is None:
    other_form_recipient.email = form_recipient.email
  else:
    other_form_recipient.email += '@pla.legalserver.org'
---
template: how_to_send_documents
content: |
  There are several ways you can provide us with a copy of your ${ form_type }:

    *   You can come to our office and we can make a copy of it;
    *   You can mail a copy of it to us;
    *   You can fax a copy of it to ${ form_recipient.fax }; or
    *   You can scan and e-mail it to ${ form_recipient.org_email }.
---
mandatory: True
code: |
  if user.is_citizen:
    form_type = "citizenship attestation"
    if user_is_willing_to_sign_citizenship_attestation and user.signature_verified and ok_to_submit_attestation_form:
      need(form_submitted)
    else:
      need(form_not_appropriate)
  else:
    form_type = "immigration documentation"
    need(user_understands_documentation_is_needed)
    if not able_to_upload:
      need(show_information_about_mailing)
    if ok_to_submit_immigration_documentation:
      need(form_submitted)
    else:
      need(form_not_appropriate)
---
question: |
  Would you like a copy of the ${ form_type } to be e-mailed to you?
yesno: user_wants_copy_emailed
---
question: |
  I am a citizen of the United States.
signature: user.signature
need: user_understands_how_to_use_signature_feature
under: |
  ${ user.name }
---
sets: success_sending_form
code: |
  to_recipients = []
  bcc_recipients = None
  if user_wants_copy_emailed:
    to_recipients.append(user)
    bcc_recipients = [form_recipient, other_form_recipient]
  else:
    to_recipients.append(form_recipient)
    to_recipients.append(other_form_recipient)
  success_sending_form = send_email(to=to_recipients, bcc=bcc_recipients, body="The " + form_type + " for " + str(user.name) + " is attached.", subject=capitalize(form_type) + " for " + str(user.name), attachments=[form_attachment])
---
sets: form_submitted
question: |
  % if success_sending_form:
    Thank you for submitting your ${ form_type }.
  % else:
    We are sorry, but there was a problem submitting your ${ form_type }.
  % endif
subquestion: |
  % if not success_sending_form:
    Please contact us about submitting your ${ form_type }.
  % endif
buttons:
  - Exit: exit
  - Restart: restart
---
question: |
  Are you willing to electronically sign a statement saying that you are a citizen?
subquestion: |
  If you say yes, you will be asked to sign your name electronically.  If you are using a computer, you can use your mouse or trackpad to write your signature.  If you are using a mobile device with a touch screen, you can use your finger to sign.  If you cannot sign your name this way, say "no" here.
yesno: user_is_willing_to_sign_citizenship_attestation
---
question: |
  Your ${ form_type } will not be submitted.
buttons:
  - Exit: exit
  - Restart: restart
sets: form_not_appropriate
---
yesno: able_to_upload
question: |
  Are you able to upload your immigration documentation?
subquestion: |
  Say yes if:
  
    *   You are using a mobile phone or tablet that has a camera; or
    *   You have a scanned copy of your documentation accessible from the computer or device you are using right now.
---
question: |
  Would you like to submit the signed document to ${ form_recipient.organization }?
subquestion: |
  The citizenship attestation is below.  Please review to make sure it is ok to submit to ${ form_recipient.organization}.  You can review the document by pressing "Preview" or by opening the PDF file.  If you would like to submit the document, press "Yes."
decoration: finishline
yesno: ok_to_submit_attestation_form
attachments:
  - name: Citizenship attestation of ${ user }
    content: |
      [BOLDCENTER] CITIZENSHIP ATTESTATION

      I am a citizen of the United States.

      [SKIPLINE]
      ${ user.signature.show(width='2in') }

      Name: ${ user }

      Date: ${ today() }
    filename: Citizenship_Attestation_${ space_to_underscore(user) }
    variable_name: form_attachment
---
field: user_understands_documentation_is_needed
question: Documentation of immigration status is needed
subquestion: |
  Funding for free legal assistance is only available to citizens and to persons with certain immigration statuses.  Our funder requires us to obtain documentation of citizenship status or immigration status from the people we assist.

  Since you are not a citizen, we need a copy of your immigration documentation for our records.  If you are a lawful permanent resident, we need a copy of your permanent resident card (green card).  If you are an asylee, we need a copy of the court order granting asylum.  Other immigration statuses have different types of documentation.
---
sets: show_information_about_mailing
buttons:
  - Exit: exit
  - Restart: restart
question: |
  Please send us your ${ form_type }.
subquestion: |
  ${ how_to_send_documents }
  
  Our address is:
  
  ${ form_recipient.address }
    
  Our phone number is ${ form_recipient.phone }.
---
yesno: ok_to_submit_immigration_documentation
question: |
  Would you like to submit this documentation?
subquestion: |
  Your documentation of immigration status is below.  Please review to make sure it is ok to submit to ${ form_recipient.organization }.  You can review the document by pressing "Preview" or by opening the PDF file.  If you would like to submit the document, press "Yes."
attachments:
  - name: Immigration documentation for ${ user }
    content: |
      [BOLDCENTER] DOCUMENTATION OF IMMIGRATION STATUS

      Name: ${ user }

      Date: ${ today() }

      ${ immigration_documentation.show() }
    filename: Immigration_documentation_of_${ space_to_underscore(user) }
    variable_name: form_attachment
---
question: |
  Please upload your immigration documentation.
fields:
  - Document: immigration_documentation
    datatype: file
...
